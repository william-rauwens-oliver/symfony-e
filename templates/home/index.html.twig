{% extends 'base.html.twig' %}

{% block title %}Fil d'actualit√©{% endblock %}

{% block body %}
    <h1 style="color:red">VERSION TEST {{ "now"|date("Y-m-d H:i:s") }}</h1>
    {% if app.user %}
        <h2>Nouvelle publication</h2>
        {{ form_start(publicationForm, {'attr': {'enctype': 'multipart/form-data'}}) }}
            {{ form_row(publicationForm.content) }}
            <button class="btn">Publier</button>
        {{ form_end(publicationForm) }}
    {% endif %}

    <hr>
    <h1>Fil d'actualit√©</h1>
    {% for publication in publications %}
        <div class="publication">
            <div class="publication-content">
                <p>Auteur : {{ publication.user.username|default('Utilisateur inconnu') }}</p>
                <p>Date : {{ publication.createdAt ? publication.createdAt|date('d/m/Y H:i') : 'Date inconnue' }}</p>
                <p>Publication #{{ publication.id|default('ID inconnu') }}</p>
                <p>Contenu : {{ publication.content|default('AUCUN CONTENU') }}</p>
                <p>Likes : {{ publication.likes|length }}</p>
                <div class="comments">
                    <h4>Commentaires ({{ publication.getCommentaires|length }})</h4>
                    {% for commentaire in publication.getCommentaires %}
                        <div class="comment">
                            <strong>{{ commentaire.user ? commentaire.user.username : 'Utilisateur inconnu' }}</strong>
                            <small>{{ commentaire.createdAt ? commentaire.createdAt|date('d/m/Y H:i') : 'Date inconnue' }}</small>
                            <p>{{ commentaire.content|default('Aucun contenu') }}</p>
                        </div>
                    {% else %}
                        <p>Aucun commentaire pour le moment.</p>
                    {% endfor %}
                </div>
            </div>
            <div class="publication-actions">
                <span class="likes">
                    <a href="{{ path('like_publication', {'id': publication.id}) }}" class="btn btn-sm">
                        ‚ù§Ô∏è J'aime
                    </a>
                </span>
                {% if app.user %}
                    <span class="comment-form-toggle">
                        <button class="btn btn-sm" onclick="toggleCommentForm({{ publication.id }})">
                            üí¨ Commenter
                        </button>
                    </span>
                {% endif %}
            </div>
        </div>
        {% if app.user %}
            <div id="comment-form-{{ publication.id }}" class="comment-form" style="display: none;">
                <form action="{{ path('app_home') }}" method="post">
                    <input type="hidden" name="publication_id" value="{{ publication.id }}">
                    <textarea name="comment_content" placeholder="Votre commentaire..." required></textarea>
                    <button type="submit" class="btn btn-sm">Publier le commentaire</button>
                </form>
            </div>
        {% endif %}
        <hr>
    {% else %}
        <p>Aucune publication pour le moment.</p>
    {% endfor %}
{% endblock %}

{% block javascripts %}
<script>
function toggleCommentForm(publicationId) {
    const form = document.getElementById('comment-form-' + publicationId);
    if (form.style.display === 'none') {
        form.style.display = 'block';
    } else {
        form.style.display = 'none';
    }
}
</script>
{% endblock %}